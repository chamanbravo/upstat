version: '3.4'
services:
  api:
    restart: unless-stopped
    build:
      context: ./
      args:
        DB_TYPE: "sqlite"
        CGO_ENABLED: 1
    env_file:
      - .env
    volumes:
      - sqlite_data:/var/lib/sqlite_data

  web:
    restart: unless-stopped
    build:
      context: web

  nginx:
    restart: unless-stopped
    image: nginx:1.21.1-alpine
    ports:
      - "$IPADDR:$PORT:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro

volumes:
  sqlite_data: